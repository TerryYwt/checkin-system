import{_ as S,r as d,o as R,d as n,f as i,g as v,j as h,h as t,w as s,B as E,i as y,E as c,F as U,p as $,k,t as F,m as L}from"./index-15fd173d.js";const M={class:"checkin"},j={class:"checkin-form"},q={key:0,class:"today-records"},z={__name:"CheckIn",setup(O){const p=d(null),m=d(!1),g=d([]),_=d([]),l=d({userId:"",note:""}),w={userId:[{required:!0,message:"請選擇用戶",trigger:"change"}]},I=async()=>{try{const a=await y.get("/api/users");g.value=a.data}catch{c.error("獲取用戶列表失敗")}},b=async()=>{try{const a=new Date().toISOString().split("T")[0],e=await y.get(`/api/checkin-records?startDate=${a}`);_.value=e.data}catch{c.error("獲取今日簽到記錄失敗")}},V=a=>new Date(a).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),x=async()=>{var a,e;if(p.value)try{await p.value.validate(),m.value=!0,await y.post("/api/checkin",l.value),c.success("簽到成功！"),l.value.userId="",l.value.note="",await b()}catch(r){(e=(a=r.response)==null?void 0:a.data)!=null&&e.error?c.error(r.response.data.error):c.error("簽到失敗："+r.message)}finally{m.value=!1}};return R(()=>{I(),b()}),(a,e)=>{const r=n("el-option"),C=n("el-select"),f=n("el-form-item"),T=n("el-input"),B=n("el-button"),D=n("el-form"),u=n("el-table-column"),N=n("el-table");return i(),v("div",M,[e[4]||(e[4]=h("h2",null,"簽到",-1)),h("div",j,[t(D,{model:l.value,"label-width":"120px",rules:w,ref_key:"formRef",ref:p},{default:s(()=>[t(f,{label:"用戶",prop:"userId"},{default:s(()=>[t(C,{modelValue:l.value.userId,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.userId=o),placeholder:"請選擇用戶",style:{width:"100%"}},{default:s(()=>[(i(!0),v(U,null,$(g.value,o=>(i(),L(r,{key:o.id,label:`${o.name} (${o.department})`,value:o.id,disabled:o.status!=="active"},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"備註",prop:"note"},{default:s(()=>[t(T,{modelValue:l.value.note,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.note=o),type:"textarea",placeholder:"請輸入備註（選填）"},null,8,["modelValue"])]),_:1}),t(f,null,{default:s(()=>[t(B,{type:"primary",onClick:x,loading:m.value},{default:s(()=>e[2]||(e[2]=[k(" 簽到 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_.value.length>0?(i(),v("div",q,[e[3]||(e[3]=h("h3",null,"今日簽到記錄",-1)),t(N,{data:_.value,style:{width:"100%"}},{default:s(()=>[t(u,{prop:"userName",label:"姓名",width:"120"}),t(u,{prop:"department",label:"部門",width:"120"}),t(u,{prop:"checkInTime",label:"簽到時間",width:"180"},{default:s(({row:o})=>[k(F(V(o.checkInTime)),1)]),_:1}),t(u,{prop:"note",label:"備註"})]),_:1},8,["data"])])):E("",!0)])}}},A=S(z,[["__scopeId","data-v-2a81d254"]]);export{A as default};
