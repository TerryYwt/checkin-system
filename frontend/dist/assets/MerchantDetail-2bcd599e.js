import{_ as Z,u as ee,a as te,c as se,r as _,b as ae,o as le,d,e as oe,f as $,g as N,h as s,w as a,i as y,E as w,j as t,t as r,k as c,l as ne,m as ie,n as re}from"./index-15fd173d.js";const de={class:"merchant-detail"},ue={class:"page-header-title"},ce={key:0,class:"loading-container"},pe={key:1,class:"merchant-details-container"},me={class:"merchant-info"},ve={class:"info-row"},_e={class:"info-item"},fe={class:"value"},ge={class:"info-item"},he={class:"value"},be={class:"info-row"},ye={class:"info-item"},we={class:"value"},Ve={class:"info-item"},ke={class:"value"},Ae={class:"info-row"},xe={class:"info-item"},Ee={class:"value"},$e={class:"info-item"},De={class:"value"},Me={class:"info-row"},Ne={class:"info-item"},Ce={class:"value"},Be={class:"info-item"},qe={class:"value"},Ue={class:"info-row"},Pe={class:"info-item"},Re={class:"value"},Te={class:"info-item"},Se={class:"value"},Ie={class:"stat-value"},Le={class:"stat-value"},je={class:"stat-value"},Qe={class:"card-header"},Fe={class:"dialog-footer"},Oe={__name:"MerchantDetail",setup(ze){const P=ee(),C=te(),p=se(()=>P.params.id),o=_({}),V=_({}),B=_([]),k=_(!0),A=_(!0),g=_(!1),D=_(null),i=ae({username:"",storeName:"",contactPerson:"",phone:"",email:"",storeAddress:"",status:"active"}),R={storeName:[{required:!0,message:"請輸入店名",trigger:"blur"},{min:2,max:50,message:"長度應為2到50個字符",trigger:"blur"}],contactPerson:[{required:!0,message:"請輸入聯絡人",trigger:"blur"}],phone:[{required:!0,message:"請輸入電話",trigger:"blur"},{pattern:/^[0-9\-+]{8,15}$/,message:"請輸入有效的電話號碼",trigger:"blur"}],email:[{required:!0,message:"請輸入Email",trigger:"blur"},{type:"email",message:"請輸入有效的Email地址",trigger:"blur"}],status:[{required:!0,message:"請選擇狀態",trigger:"change"}]},T=async()=>{try{k.value=!0;const l=await y.get(`/api/admin/merchants/${p.value}`);o.value=l.data,Object.keys(i).forEach(e=>{o.value[e]!==void 0&&(i[e]=o.value[e])}),k.value=!1}catch(l){w.error("獲取商戶詳情失敗"),console.error("Error fetching merchant details:",l),k.value=!1}},S=async()=>{try{const l=await y.get(`/api/admin/merchants/${p.value}/stats`);V.value=l.data}catch(l){console.error("Error fetching merchant stats:",l)}},I=async()=>{try{A.value=!0;const l=await y.get(`/api/admin/merchants/${p.value}/activities?limit=5`);B.value=l.data,A.value=!1}catch(l){console.error("Error fetching recent activities:",l),A.value=!1}},L=()=>{C.push("/admin/merchants")},x=l=>l?new Date(l).toLocaleString():"未知",j=()=>{g.value=!0},Q=async()=>{D.value&&await D.value.validate(async l=>{var e,u;if(l)try{(await y.put(`/api/admin/merchants/${p.value}`,i)).data&&(w.success("更新成功"),o.value={...o.value,...i},g.value=!1)}catch(m){w.error(((u=(e=m.response)==null?void 0:e.data)==null?void 0:u.message)||"更新失敗")}})},F=async()=>{var u,m;const l=o.value.status==="active"?"inactive":"active",e=l==="active"?"啟用":"禁用";try{await re.confirm(`確定要${e}商戶 "${o.value.storeName}" 嗎?`,"提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),(await y.put(`/api/admin/merchants/${p.value}/status`,{status:l})).data&&(w.success(`${e}成功`),o.value.status=l,i.status=l)}catch(h){h!=="cancel"&&w.error(((m=(u=h.response)==null?void 0:u.data)==null?void 0:m.message)||`${e}失敗`)}},O=()=>{C.push(`/admin/merchants/${p.value}/activities`)},z=l=>({login:"info",checkin:"success",campaign:"warning",qrcode:"primary",update:"info"})[l]||"info",G=l=>({login:"登入",checkin:"簽到",campaign:"活動",qrcode:"QR碼",update:"更新"})[l]||l;return le(async()=>{await T(),await Promise.all([S(),I()])}),(l,e)=>{const u=d("el-button"),m=d("el-page-header"),h=d("el-skeleton"),q=d("el-tag"),b=d("el-card"),M=d("el-col"),H=d("el-row"),E=d("el-table-column"),J=d("el-table"),f=d("el-input"),v=d("el-form-item"),U=d("el-option"),K=d("el-select"),W=d("el-form"),X=d("el-dialog"),Y=oe("loading");return $(),N("div",de,[s(m,{onBack:L,title:`商戶ID: ${p.value}`},{content:a(()=>[t("span",ue,r(o.value.storeName||"商戶詳情"),1)]),extra:a(()=>[s(u,{type:"primary",onClick:j},{default:a(()=>e[9]||(e[9]=[c("編輯商戶")])),_:1}),s(u,{type:o.value.status==="active"?"danger":"success",onClick:F},{default:a(()=>[c(r(o.value.status==="active"?"禁用商戶":"啟用商戶"),1)]),_:1},8,["type"])]),_:1},8,["title"]),k.value?($(),N("div",ce,[s(h,{rows:10,animated:""})])):($(),N("div",pe,[s(b,{class:"detail-card"},{header:a(()=>e[10]||(e[10]=[t("div",{class:"card-header"},[t("h3",null,"商戶基本信息")],-1)])),default:a(()=>[t("div",me,[t("div",ve,[t("div",_e,[e[11]||(e[11]=t("span",{class:"label"},"帳號:",-1)),t("span",fe,r(o.value.username),1)]),t("div",ge,[e[12]||(e[12]=t("span",{class:"label"},"商店名稱:",-1)),t("span",he,r(o.value.storeName),1)])]),t("div",be,[t("div",ye,[e[13]||(e[13]=t("span",{class:"label"},"聯絡人:",-1)),t("span",we,r(o.value.contactPerson),1)]),t("div",Ve,[e[14]||(e[14]=t("span",{class:"label"},"電話:",-1)),t("span",ke,r(o.value.phone),1)])]),t("div",Ae,[t("div",xe,[e[15]||(e[15]=t("span",{class:"label"},"Email:",-1)),t("span",Ee,r(o.value.email),1)]),t("div",$e,[e[16]||(e[16]=t("span",{class:"label"},"地址:",-1)),t("span",De,r(o.value.storeAddress),1)])]),t("div",Me,[t("div",Ne,[e[17]||(e[17]=t("span",{class:"label"},"狀態:",-1)),t("span",Ce,[s(q,{type:o.value.status==="active"?"success":"danger"},{default:a(()=>[c(r(o.value.status==="active"?"啟用":"禁用"),1)]),_:1},8,["type"])])]),t("div",Be,[e[18]||(e[18]=t("span",{class:"label"},"註冊日期:",-1)),t("span",qe,r(x(o.value.createdAt)),1)])]),t("div",Ue,[t("div",Pe,[e[19]||(e[19]=t("span",{class:"label"},"最後登入:",-1)),t("span",Re,r(x(o.value.lastLogin)),1)]),t("div",Te,[e[20]||(e[20]=t("span",{class:"label"},"更新日期:",-1)),t("span",Se,r(x(o.value.updatedAt)),1)])])])]),_:1}),s(H,{gutter:20,class:"stat-cards"},{default:a(()=>[s(M,{span:8},{default:a(()=>[s(b,{shadow:"hover",class:"stat-card"},{default:a(()=>[e[21]||(e[21]=t("h3",null,"總簽到次數",-1)),t("div",Ie,r(V.value.checkinCount||0),1)]),_:1})]),_:1}),s(M,{span:8},{default:a(()=>[s(b,{shadow:"hover",class:"stat-card"},{default:a(()=>[e[22]||(e[22]=t("h3",null,"活動數量",-1)),t("div",Le,r(V.value.campaignCount||0),1)]),_:1})]),_:1}),s(M,{span:8},{default:a(()=>[s(b,{shadow:"hover",class:"stat-card"},{default:a(()=>[e[23]||(e[23]=t("h3",null,"QR碼數量",-1)),t("div",je,r(V.value.qrcodeCount||0),1)]),_:1})]),_:1})]),_:1}),s(b,{class:"activities-card"},{header:a(()=>[t("div",Qe,[e[25]||(e[25]=t("h3",null,"近期活動",-1)),s(u,{type:"primary",link:"",onClick:O},{default:a(()=>e[24]||(e[24]=[c("查看全部")])),_:1})])]),default:a(()=>[ne(($(),ie(J,{data:B.value,style:{width:"100%"}},{default:a(()=>[s(E,{prop:"id",label:"ID",width:"80"}),s(E,{prop:"type",label:"類型",width:"120"},{default:a(({row:n})=>[s(q,{type:z(n.type)},{default:a(()=>[c(r(G(n.type)),1)]),_:2},1032,["type"])]),_:1}),s(E,{prop:"description",label:"描述"}),s(E,{prop:"createdAt",label:"日期",width:"180"},{default:a(({row:n})=>[c(r(x(n.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[Y,A.value]])]),_:1})])),s(X,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=n=>g.value=n),title:"編輯商戶",width:"600px"},{footer:a(()=>[t("span",Fe,[s(u,{onClick:e[7]||(e[7]=n=>g.value=!1)},{default:a(()=>e[26]||(e[26]=[c("取消")])),_:1}),s(u,{type:"primary",onClick:Q},{default:a(()=>e[27]||(e[27]=[c("保存")])),_:1})])]),default:a(()=>[s(W,{ref_key:"formRef",ref:D,model:i,rules:R,"label-width":"100px","label-position":"right"},{default:a(()=>[s(v,{label:"帳號",prop:"username"},{default:a(()=>[s(f,{modelValue:i.username,"onUpdate:modelValue":e[0]||(e[0]=n=>i.username=n),disabled:""},null,8,["modelValue"])]),_:1}),s(v,{label:"店名",prop:"storeName"},{default:a(()=>[s(f,{modelValue:i.storeName,"onUpdate:modelValue":e[1]||(e[1]=n=>i.storeName=n)},null,8,["modelValue"])]),_:1}),s(v,{label:"聯絡人",prop:"contactPerson"},{default:a(()=>[s(f,{modelValue:i.contactPerson,"onUpdate:modelValue":e[2]||(e[2]=n=>i.contactPerson=n)},null,8,["modelValue"])]),_:1}),s(v,{label:"電話",prop:"phone"},{default:a(()=>[s(f,{modelValue:i.phone,"onUpdate:modelValue":e[3]||(e[3]=n=>i.phone=n)},null,8,["modelValue"])]),_:1}),s(v,{label:"Email",prop:"email"},{default:a(()=>[s(f,{modelValue:i.email,"onUpdate:modelValue":e[4]||(e[4]=n=>i.email=n),type:"email"},null,8,["modelValue"])]),_:1}),s(v,{label:"地址",prop:"storeAddress"},{default:a(()=>[s(f,{modelValue:i.storeAddress,"onUpdate:modelValue":e[5]||(e[5]=n=>i.storeAddress=n)},null,8,["modelValue"])]),_:1}),s(v,{label:"狀態",prop:"status"},{default:a(()=>[s(K,{modelValue:i.status,"onUpdate:modelValue":e[6]||(e[6]=n=>i.status=n)},{default:a(()=>[s(U,{label:"啟用",value:"active"}),s(U,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},He=Z(Oe,[["__scopeId","data-v-3fb59ed9"]]);export{He as default};
