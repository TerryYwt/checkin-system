import{_ as C,r as m,d,f as B,g as E,h as a,w as t,i as p,E as c,j as y,k as V}from"./index-368b849d.js";const M={class:"merchant-settings"},T={__name:"MerchantSettings",setup(j){const P=m("basic"),f=m(),w=m(),N=m(),r=m({storeName:"",contactPerson:"",phone:"",email:"",address:""}),s=m({currentPassword:"",newPassword:"",confirmPassword:""}),u=m({checkinNotification:!0,campaignNotification:!0,systemNotification:!0}),k={storeName:[{required:!0,message:"請輸入商店名稱",trigger:"blur"}],contactPerson:[{required:!0,message:"請輸入聯繫人",trigger:"blur"}],phone:[{required:!0,message:"請輸入聯繫電話",trigger:"blur"},{pattern:/^[0-9]{10}$/,message:"請輸入正確的電話號碼",trigger:"blur"}],email:[{required:!0,message:"請輸入電子郵箱",trigger:"blur"},{type:"email",message:"請輸入正確的郵箱格式",trigger:"blur"}],address:[{required:!0,message:"請輸入地址",trigger:"blur"}]},x={currentPassword:[{required:!0,message:"請輸入當前密碼",trigger:"blur"}],newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{min:6,message:"密碼長度不能小於6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"請確認新密碼",trigger:"blur"},{validator:(i,e,n)=>{e!==s.value.newPassword?n(new Error("兩次輸入的密碼不一致")):n()},trigger:"blur"}]},U=async()=>{try{const e=(await p.get("/api/merchant/settings")).data;r.value={storeName:e.storeName,contactPerson:e.contactPerson,phone:e.phone,email:e.email,address:e.address},u.value={checkinNotification:e.checkinNotification,campaignNotification:e.campaignNotification,systemNotification:e.systemNotification}}catch{c.error("獲取設置失敗")}},h=async()=>{if(f.value)try{await f.value.validate(),await p.post("/api/merchant/settings/basic",r.value),c.success("保存成功")}catch(i){i!=="cancel"&&c.error("保存失敗")}},F=async()=>{if(w.value)try{await w.value.validate(),await p.post("/api/merchant/settings/password",{currentPassword:s.value.currentPassword,newPassword:s.value.newPassword}),c.success("密碼修改成功"),s.value={currentPassword:"",newPassword:"",confirmPassword:""}}catch(i){i!=="cancel"&&c.error("密碼修改失敗")}},q=async()=>{try{await p.post("/api/merchant/settings/notifications",u.value),c.success("保存成功")}catch{c.error("保存失敗")}};return U(),(i,e)=>{const n=d("el-input"),l=d("el-form-item"),g=d("el-button"),v=d("el-form"),b=d("el-tab-pane"),_=d("el-switch"),R=d("el-tabs"),S=d("el-card");return B(),E("div",M,[a(S,{class:"box-card"},{header:t(()=>e[12]||(e[12]=[y("div",{class:"card-header"},[y("span",null,"商戶設置")],-1)])),default:t(()=>[a(R,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=o=>P.value=o)},{default:t(()=>[a(b,{label:"基本設置",name:"basic"},{default:t(()=>[a(v,{ref_key:"basicFormRef",ref:f,model:r.value,rules:k,"label-width":"120px"},{default:t(()=>[a(l,{label:"商店名稱",prop:"storeName"},{default:t(()=>[a(n,{modelValue:r.value.storeName,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.storeName=o)},null,8,["modelValue"])]),_:1}),a(l,{label:"聯繫人",prop:"contactPerson"},{default:t(()=>[a(n,{modelValue:r.value.contactPerson,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.contactPerson=o)},null,8,["modelValue"])]),_:1}),a(l,{label:"聯繫電話",prop:"phone"},{default:t(()=>[a(n,{modelValue:r.value.phone,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.phone=o)},null,8,["modelValue"])]),_:1}),a(l,{label:"電子郵箱",prop:"email"},{default:t(()=>[a(n,{modelValue:r.value.email,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.email=o)},null,8,["modelValue"])]),_:1}),a(l,{label:"地址",prop:"address"},{default:t(()=>[a(n,{modelValue:r.value.address,"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.address=o),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(l,null,{default:t(()=>[a(g,{type:"primary",onClick:h},{default:t(()=>e[13]||(e[13]=[V("保存")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(b,{label:"密碼設置",name:"password"},{default:t(()=>[a(v,{ref_key:"passwordFormRef",ref:w,model:s.value,rules:x,"label-width":"120px"},{default:t(()=>[a(l,{label:"當前密碼",prop:"currentPassword"},{default:t(()=>[a(n,{modelValue:s.value.currentPassword,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.currentPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(l,{label:"新密碼",prop:"newPassword"},{default:t(()=>[a(n,{modelValue:s.value.newPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.newPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(l,{label:"確認新密碼",prop:"confirmPassword"},{default:t(()=>[a(n,{modelValue:s.value.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=o=>s.value.confirmPassword=o),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(l,null,{default:t(()=>[a(g,{type:"primary",onClick:F},{default:t(()=>e[14]||(e[14]=[V("修改密碼")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(b,{label:"通知設置",name:"notifications"},{default:t(()=>[a(v,{ref_key:"notificationFormRef",ref:N,model:u.value,"label-width":"120px"},{default:t(()=>[a(l,{label:"簽到通知"},{default:t(()=>[a(_,{modelValue:u.value.checkinNotification,"onUpdate:modelValue":e[8]||(e[8]=o=>u.value.checkinNotification=o)},null,8,["modelValue"])]),_:1}),a(l,{label:"活動通知"},{default:t(()=>[a(_,{modelValue:u.value.campaignNotification,"onUpdate:modelValue":e[9]||(e[9]=o=>u.value.campaignNotification=o)},null,8,["modelValue"])]),_:1}),a(l,{label:"系統通知"},{default:t(()=>[a(_,{modelValue:u.value.systemNotification,"onUpdate:modelValue":e[10]||(e[10]=o=>u.value.systemNotification=o)},null,8,["modelValue"])]),_:1}),a(l,null,{default:t(()=>[a(g,{type:"primary",onClick:q},{default:t(()=>e[15]||(e[15]=[V("保存")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},$=C(T,[["__scopeId","data-v-55d89c70"]]);export{$ as default};
